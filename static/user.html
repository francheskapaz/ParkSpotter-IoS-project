<!DOCTYPE html>
<html>
    <head>
        <script src="/script.js"></script>
    </head>
    <body>

        <h1>Profilo</h1>

        <div>
            ( info utente )
        </div>
        <br>
        <div id="rent" style="display:none">
            <h2>Affitta parcheggio</h2>
            <form action="" id="rentForm">
                <label for="name">Nome</label>
                <input type="text" id="name" name="name" placeholder="nome_parcheggio" required>
                <br><br>
                <label for="fee">Tariffa (â‚¬/h)</label>
                <input type="number" id="fee" name="fee" placeholder="1" required>
                <br><br>
                <label for="stop">Sosta massima (minuti)</label>
                <input type="number" id="stop" name="stop" placeholder="0" required>
                <br><br>
                <label for="coordinates">Coordinate</label>
                <input type="number" id="coordinatesN" name="coordinates" placeholder="Nord" step="any" required>
                <input type="number" id="coordinatesE" name="coordinates" placeholder="Est" step="any" required>
                <br><br>
                <label for="nSpaces">Numero di parcheggi</label>
                <input type="number" id="nSpaces" name="nSpaces" placeholder="10" required>
                <br><br>
                <label for="vehicleType">Tipo di veicolo</label>
                <select name="vehicleType" id="vehicleType">
                    <option value="car">Automobile</option>
                    <option value="motorbike">Moto</option>
                    <option value="bike">Bicicletta</option>
                </select>
                <br><br>
                <button type="submit">Invia</button>
            </form>
        </div>

        <script>
        // Show "affitta parcheggio" to user "Proprietario"
        getUserType()
        .then((userType) => {
            if (userType === 'Unauthenticated') {
                document.location = '/login.html';
            } else if (userType === 'Proprietario') {
                document.getElementById("rent").style.display = 'block';
            }
        })
        </script>
        <script>
        let rentForm = document.getElementById("rentForm");
        rentForm.addEventListener("submit", (e) => {
            e.preventDefault();

            const data = {
                name: document.getElementById('name').value,
                fee: Number(document.getElementById('fee').value),
                maxStop: Number(document.getElementById('stop').value),
                open: false,
                coordinates: {
                    nord: Number(document.getElementById('coordinatesN').value),
                    est: Number(document.getElementById('coordinatesE').value)
                },
                nParkingSpaces: Number(document.getElementById('nSpaces').value),
                vehicleType: document.getElementById('vehicleType').value
            };

            fetch('/api/v1/parkings', {
                method: 'PUT',
                headers: new Headers({
                    'Content-Type': 'application/json',
                    'X-access-token': window.localStorage.getItem('token')
                }),
                body: JSON.stringify(data)
            })
                .then((res) => {
                    return res.json();
                })
                .then((data) => {
                    if (data.success) {
                        alert('Parcheggio salvato correttamente');
                    }
                })
        });

        </script>
    </body>
</html>

